<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lab de Prazos/Tasks</title>
  <link rel="stylesheet" href="./styles.css" />

  <style>
    /* === Layout pedido: metade esquerda (detalhe), metade direita (lista) === */
    html, body {
      height: 100%;
      overflow: hidden;           /* sem rolagem da página */
    }
    .lab-root {
      height: 100vh;
      display: flex;
      gap: 10px;
      padding: 10px;
      box-sizing: border-box;
    }
    .pane {
      min-width: 0;
      display: flex;
      flex-direction: column;
    }
    .pane-left  { flex: 1 1 50%; }
    .pane-right { flex: 1 1 50%; }

    /* Cartões reaproveitando seu styles.css */
    .card { margin-bottom: 10px; }

    /* ===== Lista de processos (metade direita) ===== */
    .proc-list {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .proc-title { margin: 0 0 8px 0; }
    .list-wrap {
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;          /* rolagem **interna** */
      overflow-x: hidden;        /* sem rolagem horizontal */
      border: 1px solid #ddd;
      border-radius: 6px;
      background: #fff;
    }

    :root{
      /* larguras pensadas para evitar rolagem horizontal */
      --w-nup: clamp(22ch, 24ch, 26ch);
      --w-tipo: clamp(10ch, 12ch, 14ch);
      --w-status: minmax(0, 1.4fr);
      --w-entrada: clamp(12ch, 14ch, 16ch);
      --w-atualizado: clamp(16ch, 18ch, 20ch);
    }

    .pl-grid-header,
    .pl-row{
      display: grid;
      grid-template-columns:
        var(--w-nup)
        var(--w-tipo)
        var(--w-status)
        var(--w-entrada)
        var(--w-atualizado);
      gap: 0;
      align-items: center;
      white-space: nowrap;
    }
    .pl-grid-header{
      position: sticky; top: 0; z-index: 2;
      background: #f9f9f9;
      border-bottom: 1px solid #ddd;
      font-weight: 600;
    }
    .pl-grid-header > div,
    .pl-row > div{
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: center;
      padding: 6px 8px;
      font-size: 12px;
    }
    .pl-row{
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }
    .pl-row:hover{ background: #fafafa; }
    .pl-row.selected{ outline: 2px solid #999; outline-offset: -1px; }

    /* ===== Área de tarefas (esquerda) com altura 100% ===== */
    .left-scroll {
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;          /* rolagem **interna** para tarefas longas */
    }
    .row-task {
      display: grid;
      grid-template-columns: 18ch 1fr 12ch 20ch 16ch 1.5fr;
      gap: 8px; padding: 6px 0; border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>

  <div class="lab-root">
    <!-- =======================================
         METADE ESQUERDA: Controles + Tarefas
         ======================================= -->
    <div class="pane pane-left">
      <div class="card">
        <h2>Lab — Processos & Tarefas</h2>

        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
          <input id="nup" placeholder="00000.000000/0000-00" />
          <button id="btn-load">Carregar processo</button>

          <select id="novo-status" title="Mudar status do processo carregado">
            <option value="">— mudar status —</option>
            <option>Aguardando ANAC</option>
            <option>Análise Documental</option>
            <option>Análise ICA</option>
            <option>Análise Téc. Prel.</option>
            <option>Análise Técnica</option>
            <option>Confecção de Doc.</option>
            <option>Revisão OACO</option>
            <option>Aprovação</option>
            <option>Sobrestado</option>
            <option>Portaria</option>
            <option>Remoção/Rebaixamento</option>
            <option>Término de Obra</option>
            <option>Atraso Término de Obra</option>
            <option>Aguardando Ciência</option>
            <option>Arquivado</option>
          </select>
          <button id="btn-aplicar">Aplicar status</button>
        </div>

        <div id="msg" class="small"></div>
      </div>

      <div class="card left-scroll">
        <h3>Tarefas do processo</h3>
        <div id="tasks"></div>

        <h3 style="margin-top:14px">Ações rápidas</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px">
          <button data-act="PARECER" data-org="ATM">Solicitar ATM (10d)</button>
          <button data-act="PARECER" data-org="DT">DT (10d)</button>
          <button data-act="PARECER" data-org="CGNA">CGNA (30d)</button>
          <button data-act="PARECER" data-org="DECEA">DECEA (30d)</button>
          <button data-act="PARECER" data-org="COMAE">COMAE (30d)</button>
          <button data-act="PARECER" data-org="COMPREP">COMPREP (30d)</button>
          <button data-act="PARECER" data-org="GABAER">GABAER (30d)</button>
          <button data-act="PARECER" data-org="COMGAP">COMGAP (90d)</button>
          <button id="btn-sigad">Iniciar SIGAD (COMAE+COMGAP)</button>
        </div>
      </div>
    </div>

    <!-- =======================================
         METADE DIREITA: Lista de processos
         ======================================= -->
    <div class="pane pane-right">
      <div class="proc-list">
        <h3 class="proc-title">Lista de processos</h3>
        <div class="list-wrap" id="proc-list">
          <div class="pl-grid-header">
            <div>NUP</div>
            <div>Tipo</div>
            <div>Status</div>
            <div>1ª Entrada</div>
            <div>Atualizado</div>
          </div>
          <!-- Linhas entram aqui -->
          <div id="pl-body"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mantém seus mesmos arquivos de ambiente/cliente -->
  <script src="./env.js"></script>
  <script type="module" src="./lab.js"></script>
</body>
</html>
