<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lab de Prazos/Tasks</title>

  <!-- Usa o seu CSS existente -->
  <link rel="stylesheet" href="./styles.css" />

  <style>
    /* ===== Layout 50/50, sem rolagem de página ===== */
    html, body { height: 100%; overflow: hidden; }
    .lab-root { height: 100vh; display: flex; gap: 10px; padding: 10px; box-sizing: border-box; }
    .pane { min-width: 0; display: flex; flex-direction: column; }
    .pane-left  { flex: 1 1 50%; }
    .pane-right { flex: 1 1 50%; }

    .card { margin-bottom: 10px; }

    /* ===== Lista (metade direita) – só rolagem vertical interna ===== */
    .proc-list { display: flex; flex-direction: column; height: 100%; }
    .proc-title { margin: 0 0 8px 0; }
    .list-wrap { flex: 1 1 auto; min-height: 0; overflow-y: auto; overflow-x: hidden;
                 border: 1px solid #ddd; border-radius: 6px; background: #fff; }

    :root{
      --w-nup: clamp(22ch, 24ch, 26ch);
      --w-tipo: clamp(10ch, 12ch, 14ch);
      --w-status: minmax(0, 1.4fr);
      --w-entrada: clamp(12ch, 14ch, 16ch);
      --w-atualizado: clamp(16ch, 18ch, 20ch);
    }
    .pl-grid-header, .pl-row{
      display: grid;
      grid-template-columns: var(--w-nup) var(--w-tipo) var(--w-status) var(--w-entrada) var(--w-atualizado);
      gap: 0; align-items: center; white-space: nowrap;
    }
    .pl-grid-header{ position: sticky; top: 0; z-index: 2; background: #f9f9f9; border-bottom: 1px solid #ddd; font-weight: 600; }
    .pl-grid-header > div, .pl-row > div{ overflow: hidden; text-overflow: ellipsis; text-align: center; padding: 6px 8px; font-size: 12px; }
    .pl-row{ border-bottom: 1px solid #eee; cursor: pointer; }
    .pl-row:hover{ background: #fafafa; }
    .pl-row.selected{ outline: 2px solid #999; outline-offset: -1px; }

    /* ===== Painel esquerdo: o segundo card ocupa o resto e tem rolagem interna ===== */
    .left-scroll { flex: 1 1 auto; min-height: 0; overflow-y: auto; }

    /* ===== Subcards dos controles (grid) ===== */
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; }
    .subcard { border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: #fff; }
    .subcard h4 { margin: 0 0 8px 0; }

    /* Inputs compactos */
    .ctl { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; margin: 6px 0; }
    .ctl input[type="datetime-local"], .ctl input[type="date"] { height: 34px; }
    .note { font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <div class="lab-root">
    <!-- ========================= METADE ESQUERDA ========================= -->
    <div class="pane pane-left">
      <!-- Card 1: carregar processo + mudar status -->
      <div class="card">
        <h2>Lab — Processos & Tarefas</h2>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
          <input id="nup" placeholder="00000.000000/0000-00" />
          <button id="btn-load">Carregar processo</button>

          <select id="novo-status" title="Mudar status do processo carregado">
            <option value="">— mudar status —</option>
            <option>Aguardando ANAC</option>
            <option>Análise Documental</option>
            <option>Análise ICA</option>
            <option>Análise Téc. Prel.</option>
            <option>Análise Técnica</option>
             <option>Análise GABAER</option>
            <option>Confecção de Doc.</option>
            <option>Revisão OACO</option>
            <option>Aprovação</option>
            <option>Sobrestado</option>
            <option>Portaria</option>
            <option>Remoção/Rebaixamento</option>
            <option>Término de Obra</option>
            <option>Atraso Término de Obra</option>
            <option>Aguardando Ciência</option>
            <option>Arquivado</option>
          </select>
          <button id="btn-aplicar">Aplicar status</button>
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
          <span class="note">Ações rápidas de parecer:</span>
          <button data-act="PARECER" data-org="ATM">ATM (10d)</button>
          <button data-act="PARECER" data-org="DT">DT (10d)</button>
          <button data-act="PARECER" data-org="CGNA">CGNA (30d)</button>
          <button data-act="PARECER" data-org="DECEA">DECEA (30d)</button>
          <button data-act="PARECER" data-org="COMAE">COMAE (30d)</button>
          <button data-act="PARECER" data-org="COMPREP">COMPREP (30d)</button>
          <button data-act="PARECER" data-org="GABAER">GABAER (30d)</button>
          <button data-act="PARECER" data-org="COMGAP">COMGAP (90d)</button>
          <button data-act="PARECER" data-org="OPR AD">OPR AD (30d)</button>
        </div>

        <div id="msg" class="small" style="margin-top:6px"></div>
      </div>

      <!-- Card 2: CONTROLES EM SUBCARDS -->
      <div class="card left-scroll">
        <h3>Controles de prazos (por categoria)</h3>
        <div class="cards-grid" id="cards-grid">

          <div class="subcard" id="card-sigad">
            <h4>SIGADAER</h4>
            <div class="ctl">
              <button id="btn-sigad">Iniciar SIGAD (COMAE + COMGAP)</button>
              <span class="note">Cria Minuta → Revisão → Aprovação → <b>Expedição</b>.</span>
            </div>
            <div id="ctl-sigad"></div>
          </div>

          <div class="subcard" id="card-termino">
            <h4>Término de Obra</h4>
            <div id="ctl-termino"></div>
          </div>

          <div class="subcard" id="card-atraso">
            <h4>Atraso Término de Obra</h4>
            <div id="ctl-atraso"></div>
          </div>

          <div class="subcard" id="card-aguardando">
            <h4>Aguardando Ciência</h4>
            <div class="note">Use para pendências com “Data de Ciência”.</div>
            <div id="ctl-aguardando"></div>
          </div>

          <div class="subcard" id="card-remocao">
            <h4>Remoção/Rebaixamento</h4>
            <div id="ctl-remocao"></div>
          </div>

          <div class="subcard" id="card-sobrestado">
            <h4>Sobrestado</h4>
            <div class="note">Defina <b>Tipo</b> (Técnico/Documental) e a <b>Data de Ciência</b>. O prazo nasce depois disso (120d ou 60d a partir da ciência).</div>
            <div id="ctl-sobrestado"></div>
          </div>

        </div>
      </div>
    </div>

    <!-- ========================= METADE DIREITA ========================= -->
    <div class="pane pane-right">
      <div class="proc-list">
        <h3 class="proc-title">Lista de processos</h3>
        <div class="list-wrap" id="proc-list">
          <div class="pl-grid-header">
            <div>NUP</div><div>Tipo</div><div>Status</div><div>1ª Entrada</div><div>Atualizado</div>
          </div>
          <div id="pl-body"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mantém env.js e cliente Supabase -->
  <script src="./env.js"></script>
  <script type="module" src="./lab.js"></script>
</body>
</html>
